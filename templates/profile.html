{% extends "base.html" %}

{% comment %}
	User Profile Page
{% endcomment %}

{% block head %}
	<meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.4.2/pure-min.css" type="text/css">
	
	<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
	<script type="text/javascript" src="{{STATIC_URL}}js/jquery-2.1.0.min.js"></script>
	<!-- Include all compiled plugins (below), or include individual files as needed -->
	<script type="text/javascript" src="{{STATIC_URL}}bootstrap/js/bootstrap.min.js"></script>
	<!-- js file of the plugin -->
	<script type="text/javascript" src="{{STATIC_URL}}js/jquery.leanModal.min.js"></script>
	<!-- Initializing the plugin for the goal popup -->
	<script>
		$(document).ready(function(){
			$("a[rel*=oneshotgoal-form]").leanModal({ top : 200, overlay : 0.8, closeButton: ".modal_close" });
		});
	</script>
	{% load bootstrap3 %}
	{% load staticfiles %}

    <!-- Bootstrap -->
    <link href="{{STATIC_URL}}bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css">
    <link href="{{STATIC_URL}}css/cover.css" rel="stylesheet" type="text/css">
    <link rel= "stylesheet" href = "{{STATIC_URL}}css/profile.css" type="text/css">
	
	<script>
		function cloneMore(selector, type) {
			var newElement = $(selector).clone(true);
			var total = $(selector).length;
			newElement.find(':input').each(function() {
				var name = $(this).attr('name').replace('-' + (total-1) + '-', '-' + total + '-');
				var id = 'id_' + name;			
				$(this).attr({'name': name, 'id': id}).val('').removeAttr('checked');
			});
			newElement.find('label').each(function() {
				var newFor = $(this).attr('for').replace('-' + (total-1) + '-', '-' + total + '-');
				$(this).attr('for', newFor);
			});
			total++;
			$('#id_' + type + '-TOTAL_FORMS').val(total);
			$(selector).after(newElement);
		}
	</script>
{% endblock %}

{% block body %}
	{% if user.is_authenticated %}
		<h1>Hey, {{ user.username }}!</h1>
		<a href="/logout/">Logout</a><br />
		<h2>Profile:</h2>
		{% if user.profile.user_image %}
			<p>change password</p>
			<p>Would you like to upload a new profile image?</p><br/>
		{% else %}
			<p>change password</p>
			<p>It looks like you don't have a profile image.</p>
			<p>Would you like to upload one?</p><br/>
		{% endif %}
		<h3>Goals:</h3>
		{% if oneshotgoalcount == 0 %}
			<p>Hey it looks like you don't have any One Shot Goals.</p>
			<p>Would you like to add one?</p>
			<a href="#oneshotgoal-form" class="pure-button" rel="oneshotgoal-form">New One Shot Goal</a>
			<form class="pure-form pure-form-stacked" action="" method="post" id="oneshotgoal-form">
				{% csrf_token %}
				<p>New One Shot Goal</p>
				{% bootstrap_form oneshotgoalform %}
				<input class="pure-button pure-input-1 pure-button-primary" type="submit" value="Submit" name="osgoalSub"/>
			</form>
		{% else %}
			<p>One Shot Goals:</p>
			{% for osgoal in oneshotgoals %}
				<a href="/{{ user.username }}/osgoals/{{ osgoal.title|slugify }}{{ osgoal.id }}">{{ osgoal.title }}</a>
			{% endfor %}
			<a href="#oneshotgoal-form" class="pure-button" id="newoneshotgoal-button" rel="oneshotgoal-form">New One Shot Goal</a>
			<form class="pure-form pure-form-stacked" action="" method="post" id="oneshotgoal-form">
				{% csrf_token %}
				<p>New One Shot Goal</p>
				{% bootstrap_form oneshotgoalform %}
				<input class="pure-button pure-input-1 pure-button-primary" type="submit" value="Submit" name="osgoalSub"/>
			</form>
			<p>Milestone Goals:</p>
			<form class="pure-form pure-form-stacked" action="" method="post" id="milestonegoal-form">
				{% csrf_token %}
				<p>Milestone Goal</p>
				{% bootstrap_form milestonegoalform %}
				{{ milestoneformset.management_form }}
				<div id='milestoneform_set'>
					{% for form in milestoneformset.forms %}
						<table class='no_error'>
							<p>Milestone</p>
							{{ form.as_table }}
						</table>
					{% endfor %}
				</div>
				<input type="button" value="Add Milestone" id="add_milestone"/>
				<div id='empty_form' style='display:none'>
					<table class = 'no_error'>
						<p>Milestone</p>
						{{ milestoneformset.empty_form.as_table }}
					</table>
				</div>
				<script>
					$('#add_milestone').click(function() {
						var form_idx = $('#id_form-TOTAL_FOMRS').val();
						$('#milestoneform_set').append($('#empty_form').html().replace(/__prefix__/g, form_idx));
						$('#id_form-TOTAL_FORMS').val(parseInt(form_idx) + 1);
					});
				</script>
				<input class="pure-button pure-input-1 pure-button-primary" type="submit" value="Submit" name="msgoalSub"/>
			</form>
		{% endif %}
	{% else %}
		<h1>No one's logged in...</h1>
		<a href="{% url 'homepage' %}">Login?</a><br />
	{% endif %}
{% endblock %}